upstream appsapca.leon-grosse.fr {
    server tomcat-apca:8080;
}

upstream appsacau.leon-grosse.fr {
    server tomcat-acau:8080;
}

upstream appsasgr.leon-grosse.fr {
    server tomcat-asgr:8080;
}

upstream appsagpe.leon-grosse.fr {
    server tomcat-agpe:8080;
}

upstream appsacdc.leon-grosse.fr {
    server tomcat-acdc:8080;
}

upstream appsarlg.leon-grosse.fr {
    server tomcat-arlg:8080;
}

server {
    listen 80;
    listen [::]:80;
    
    listen 443 ssl;
    ssl_certificate /etc/nginx/ssl/xxx.leon-grosse.fr.cer;
    ssl_certificate_key /etc/nginx/ssl/xxx.leon-grosse.fr.key;

    server_name srv-appspe.leon-grosse.fr;

    access_log /etc/nginx/log/apps-access.log;
    error_log /etc/nginx/log/apps-error.log;

    add_header SAMACCOUNTNAME $http_samaccountname;

    location /apca/ {
        access_log /etc/nginx/log/apps-apca-access.log;
        error_log /etc/nginx/log/apps-apca-error.log;

        proxy_http_version 1.1;
        proxy_set_header Connection "";
        proxy_set_header SAMACCOUNTNAME $http_samaccountname;
        proxy_pass http://appsapca.leon-grosse.fr/;
    }

    location /acau/ {
        access_log /etc/nginx/log/apps-acau-access.log;
        error_log /etc/nginx/log/apps-acau-error.log;

        proxy_http_version 1.1;
        proxy_set_header Connection "";
        proxy_set_header SAMACCOUNTNAME $http_samaccountname;
        proxy_pass http://appsacau.leon-grosse.fr/;
    }

    location /asgr/ {
        access_log /etc/nginx/log/apps-asgr-access.log;
        error_log /etc/nginx/log/apps-asgr-error.log;

        proxy_http_version 1.1;
        proxy_set_header Connection "";
        proxy_set_header SAMACCOUNTNAME $http_samaccountname;
        proxy_pass http://appsasgr.leon-grosse.fr/;
    }

    location /agpe/ {
        access_log /etc/nginx/log/apps-agpe-access.log;
        error_log /etc/nginx/log/apps-agpe-error.log;

        proxy_http_version 1.1;
        proxy_set_header Connection "";
        proxy_set_header SAMACCOUNTNAME $http_samaccountname;
        proxy_pass http://appsagpe.leon-grosse.fr/;
    }

    location /acdc/ {
        access_log /etc/nginx/log/apps-acdc-access.log;
        error_log /etc/nginx/log/apps-acdc-error.log;

        proxy_http_version 1.1;
        proxy_set_header Connection "";
        proxy_set_header SAMACCOUNTNAME $http_samaccountname;
        proxy_pass http://appsacdc.leon-grosse.fr/;
    }

    location /arlg/ {
        access_log /etc/nginx/log/apps-arlg-access.log;
        error_log /etc/nginx/log/apps-arlg-error.log;

        proxy_http_version 1.1;
        proxy_set_header Connection "";
        proxy_set_header SAMACCOUNTNAME $http_samaccountname;
        proxy_pass http://appsarlg.leon-grosse.fr/;
    }
}
